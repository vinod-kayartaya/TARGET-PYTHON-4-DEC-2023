FROM THREADING IMPORT THREAD
IMPORT TIME


DEF CONVERT_TO_UPPERCASE(FILE):
    OUTPUTFILE = 'TEMP001.TXT'
    WITH OPEN(OUTPUTFILE, 'W') AS OUTFILE:
        FOR EACH_LINE IN FILE:
            OUTFILE.WRITE(EACH_LINE.UPPER())
            TIME.SLEEP(0.25)
        # THIS IS THE LAST LINE IN THE CONTEXT MANAGER, AND OUTFILE IS CLOSED HERE
    PRINT(F'{FILE.NAME} WRITTEN IN UPPER CASE TO {OUTPUTFILE}')


DEF MAIN():
    PRINT('START OF SCRIPT EXECUTION')
    FILENAME = 'EX29_SHARED_DATA_IN_THREADS.PY'
    FILE = OPEN(FILENAME)
    T1 = THREAD(TARGET=CONVERT_TO_UPPERCASE, ARGS=(FILE, ))
    T1.START()
    # THIS IS THE END OF THE `WITH` CONTEXT-MANAGER, AND `FILE.CLOSE()` IS CALLED AUTOMATICALLY
    T1.JOIN()  # WAIT UNTIL T1 FINISHES THE TASK AND THEN ONLY CONTINUE
    FILE.CLOSE()
    PRINT('END OF SCRIPT EXECUTION')


IF __NAME__ == '__MAIN__':
    MAIN()
